====================
Analysis
====================

Example 1 - End-valve closure
-----------------------------

This example shows how to simulate the closure of a
TSNet package:



5. Summary Damage
-------------------------------
.. figure:: figures/damage.png
   :scale: 25%
   :alt: Logo

1.  Import TSNet package, read the EPANET INP file,
    and create transient model object.

.. literalinclude:: ../simulation/damageanalysis.py

----

This example reveals how TSNet simulates pipe bursts and leaks.
This example network, adapted from [OSBH08]_, is shown below in :numref:`tnet3`.
Tnet3 comprises 168 pipes, 126 junctions, 8 valve, 2 pumps,
one reservoir, and two tanks.
The transient event is generated by a burst and a background leak.
There are five steps that the user would need to take:

.. _tnet3:
.. figure:: figures/Tnet3.PNG
   :width: 600
   :alt: tnet3

   Tnet3 network graphics


1.  Import TSNet package, read the EPANET INP file,
    and create transient model object.

.. literalinclude:: ../simulation/fragility_rehab.py
    :lines: 1-4

2.  The user can import custom wave speeds for each pipe.
    To demonstrate how to assign different wave speed,
    we assume that the wave speed for the pipes is normally distributed
    with mean of :math:`1200 m/s` and standard deviation of
    :math: `100m/s`. Then, assign the randomly generated wave speed
    to each pipe in the network according to the order the pipes
    defined in the INP file. Subsequently, set the simulation period
    as :math:`20s`, and use suggested time step.

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 6-12

3.  Define background leak location, JUNCTION-22,
    and specify the emitter coefficient.
    The leak will be included in the initial condition calculation.
    See WNTR documentation [WNTRSi]_ for more info about leak simulation.

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 14-16

4.  Compute steady state results to establish the initial
    condition for transient simulation.

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 24-27

5.  Set up burst event, including burst location, JUNCTION-20,
    burst start time (:math:`ts`),
    time for burst to fully develop (:math:`tc`), and the final emitter
    coefficient (final_burst_coeff).

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 18-22

6. Run transient simulation and specify the name of the results file.

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 29-31

After the transient simulation, the results at nodes and links
will be returned to the transient model (tm) instance,
which is subsequently stored in **Tnet3.obj**.


To understand how much water has been lost through the leakage
at JUNCTION-22, we can plot the leak discharge results at JUNCTION-22:

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 34-45

yields :numref:`tnet3_leak`:


.. _tnet3_leak:
.. figure:: figures/tnet3_leak.png
   :width: 600
   :alt: tnet3_leak

   Tnet3 - Leak discharge at node JUNCTION-22.

Similarly, to reveal how much water has been wasted through the burst event
at JUNCTION-20, we can plot the burst discharge results at JUNCTION-20:

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 48-58

yields :numref:`tnet3_burst`:

.. _tnet3_burst:
.. figure:: figures/tnet3_burst.png
   :width: 600
   :alt: tnet3_burst

   Tnet3 - Burst discharge at node JUNCTION-20.

Additionally, to plot the velocity results in LINK-40:

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 61-72

yields :numref:`tnet3_pipe`:

.. _tnet3_pipe:
.. figure:: figures/tnet3_pipe.png
   :width: 600
   :alt: tnet3_pipe

   Tnet3 - Velocity at the start and end node of LINK-40.

Moreover, we can plot head results at some further nodes, such as
JUNCTION-8, JUNCTION-16, JUNCTION-45, JUNCTION-90, by:

.. literalinclude:: ../examples/Tnet3_burst_leak.py
    :lines: 75-90

The results are demonstrated in :numref:`tnet3_multi`. It can be noticed that
the amplitude of the pressure transient at JUNCTION-8 and JUNCTION-16
is greater than that at other two junctions which are further away from
JUNCTION-20, where the burst occurred.

.. _tnet3_multi:
.. figure:: figures/tnet3_multi.png
   :width: 600
   :alt: tnet3_multi

   Tnet3 - Head at multiple junctions.


More examples are includeded in https://github.com/glorialulu/TSNet/tree/master/examples.
